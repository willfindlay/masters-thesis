\documentclass[
  fontsize=12pt,
  titlepage=firstiscover,
  paper=letter,
  %twoside,
  oneside,
  cleardoublepage=plain,
  parskip=half-,
  DIV=10,
  parindent,
  appendixprefix,
  chapterprefix,
  listof=totoc,
  %final
]{scrbook}

\usepackage[utf8]{inputenc}

\usepackage[acronym, toc, numberedsection=nolabel, section=chapter]{glossaries}
\setacronymstyle{short-long}
\makeglossaries
\newacronym{os}{OS}{Operating System}
\newacronym{bpf}{BPF}{Berkeley Packet Filter}
\newacronym{ebpf}{eBPF}{Extended \glsentryshort{bpf}}
\newacronym{cbpf}{cBPF}{Classic \glsentryshort{bpf}}
\newacronym{btf}{BTF}{\glsentryshort{bpf} Type Format}
\newacronym{jit}{JIT}{Just-In-Time}
\newacronym{core}{CO-RE}{Compile Once, Run Everywhere}
\newacronym{dac}{DAC}{Discretionary Access Control}
\newacronym{acl}{ACL}{Access Control List}
\newacronym{mac}{MAC}{Mandatory Access Control}
\newacronym{mls}{MLS}{Multi-Level Security}
\newacronym{lsm}{LSM}{Linux Security Modules}
\newacronym{krsi}{KRSI}{Kernel Runtime Security Instrumentation}
\newacronym{usdt}{USDT}{User Statically Defined Tracepoints}
\newacronym{pid}{PID}{Process ID}
\newacronym{tid}{TID}{Thread ID}
\newacronym{tgid}{TGID}{Task Group ID}
\newacronym{uts}{UTS}{Unix Timesharing System}
\newacronym{uid}{UID}{User ID}
\newacronym{gid}{GID}{Group ID}
\newacronym{euid}{EUID}{Effective \glsentrylong{uid}}
\newacronym{egid}{EGID}{Effective \glsentrylong{gid}}
\newacronym{tcb}{TCB}{Trusted Computing Base}
\newacronym{cots}{COTS}{Commercial Off-The-Shelf}
\newacronym{ipc}{IPC}{Inter-Process Communication}
\newacronym{ip}{IP}{Internet Protocol}
\newacronym{toctou}{TOCTTOU}{Time of Check to Time of Use}
\newacronym{isa}{ISA}{Instruction Set Architecture}
\newacronym{fpga}{FPGA}{Field-Programmable Gate Array}
\newacronym{abi}{ABI}{Application Binary Interface}
\newacronym{api}{API}{Application Programming Interface}
\newacronym{aslr}{ASLR}{Address Space Layout Randomization}
\newacronym{kaslr}{KASLR}{Kernel \glsentryshort{aslr}}
\newacronym{mmu}{MMU}{Memory Management Unit}
\newacronym{tlb}{TLB}{Translation Lookaside Buffer}
\newacronym{vm}{VM}{Virtual Machine}
\newacronym{lxc}{LXC}{Linux Containers}
\newacronym{cpu}{CPU}{Central Processing Unit}
\newacronym{gui}{GUI}{Graphical User Interface}
\newacronym{oci}{OCI}{Open Container Initiative}
\newacronym{cgi}{CGI}{Common Gateway Interface}
\newacronym{vfs}{VFS}{Virtual Filesystem}

\usepackage{findlay}
\usepackage{langs}
\usepackage{listings-rust}
\usepackage{epigraph}
\usepackage{circledsteps}
\usepackage{subfig}

% for changing margins in titlepage
\RequirePackage{geometry}

% for 1.5 line spacing
\RequirePackage{setspace}
\doublespacing%
% single spacing for table of contents
\AfterTOCHead{\singlespacing}

% recompute page layout based on the above
\recalctypearea%

% Use rmfamily for chapters, sections, etc.
\addtokomafont{disposition}{\rmfamily}

% Fix top and bottom margins
%\newgeometry{margin=1in}

% Uncomment this to help debug layout
%\usepackage{showframe}

\setcapindent{0pt}

\newcommand{\bpfbox}{\textsc{BPFBox}}
\newcommand{\bpfcontain}{\textsc{BPFContain}}

\addbibresource{refs.bib}

\title{A Practical, Lightweight, and Flexible Confinement Framework in eBPF}
\author{William P.\ Findlay}
\date{August, 2021}

\hyphenation{App-Armor}

% Remove spurious dot in figure/table captions
\renewcommand*{\figureformat}{%
  \figurename~\thefigure%
}
\renewcommand*{\tableformat}{%
  \tablename~\thetable%
}

\renewcommand{\lstlistlistingname}{List of Code Listings}

% Custom labels for research questions
\newlist{rqenum}{enumerate}{1}
\setlist[rqenum]{label=\textbf{RQ\arabic*}, ref=\textbf{RQ\arabic*}}
\crefname{research question}{Research Question}{Research Questions}
\crefalias{rqenumi}{research question}

\begin{document}

% ==============================================================================
% Cover Page, Abstract and TOC
% ==============================================================================

% Title page
\makeatletter
\begin{titlepage}
    \newgeometry{margin=0.8in}
    \begin{center}
      \vspace*{1cm}
      {\LARGE\bfseries \@title}

      \vspace{1cm}
      by
      \vspace{1cm}

      {\itshape\large \@author\/}

      \vfill

      A thesis submitted to the Faculty of Graduate and Postdoctoral Affairs\\
      in partial fulfillment of the requirements for the degree of

      \vspace{3cm}
      {\bfseries Master of Computer Science}
      \vspace{3cm}


      {\@date}
      \vspace{0.5cm}

      Carleton University\\
      Ottawa, Ontario
      \vspace{0.5cm}

      \copyright{}~2021 \@author%
    \end{center}
\end{titlepage}
\makeatother
\cleardoublepage

\renewcommand*{\titlepagestyle}{plain}

\frontmatter%

\vspace*{6em}
\begin{center}
\textit{To my parents and grandparents, for believing in me\\even when I didn't believe in myself.}
\end{center}
\vspace*{\fill}

\chapter*{Abstract}%
\addcontentsline{toc}{chapter}{Abstract}%
\begingroup
\small
Confining operating system processes is essential for preserving least-privilege access to
system resources, hardening the system against successful exploitation by malicious
actors. Classically, confinement on Linux has been accomplished through a variety of
disparate confinement primitives, each targeting a different aspect of process behaviour
and each with its own set of policy semantics. This has led to difficulties in realizing
practical confinement goals, due to the complexities, inter-dependence relationships, and
semantic gaps that arise from recombining existing confinement primitives in unintended
ways. Linux containers are a particularly poignant example of this phenomenon, with
existing container security policies often being overly complex and overly permissive in
practice.

To better isolate user processes and achieve practical confinement goals, we argue that
novel confinement mechanisms are needed to bridge the semantic gap between security policy
and enforcement. We hypothesize that a new Linux kernel technology, eBPF, enables the
creation of precisely such a confinement mechanism. eBPF programs can be dynamically
loaded into the kernel by a privileged process and are checked for safety before they run
in kernelspace.  This approach affords an opportunity to create an adoptable,
container-specific confinement mechanism without tying the kernel down to one specific
implementation.  Further, an eBPF-based confinement solution can be loaded and unloaded at
runtime, without updating or even restarting the operating system kernel; this property
enables rapid prototyping and debugging, similar in spirit to how we debug userspace
applications in practice.

In this thesis, we present the design and implementation of two novel confinement
solutions based on eBPF, \bpfbox{} and its successor, \bpfcontain{}. We discuss issues in
the Linux confinement space that motivated the creation of \bpfbox{} and \bpfcontain{},
discuss policy examples, and present the results of a performance evaluation and informal
security analysis. Results from this research indicate that \bpfbox{} and \bpfcontain{}
incur modest overhead despite their increased flexibility over existing Linux security
solutions.  We also find that there is significant opportunity to improve \bpfbox{} and
\bpfcontain{}, and to introduce future security mechanisms based on eBPF\@.

\endgroup
\cleardoublepage%

% \chapter*{Acknowledgements}%
% \addcontentsline{toc}{chapter}{Acknowledgements}%
% \begingroup
% \small
% \enlargethispage{2\baselineskip}
% I would first and foremost like to thank my thesis supervisors, Dr.\ Anil Somayaji and
% Dr.\ David Barrera for their constant support, sage advice, and invaluable feedback
% (particularly on early drafts of this document). I feel confident in saying that I would
% not have reached this point in my graduate school career if not for their dedication and
% encouragement. I am also grateful to my other committee members, Dr.\ Lianying (Viau) Zhao
% and Dr.\ Paula Branco for taking the time to read and evaluate my work.

% I would also like to thank the professors and fellow members of the CCSL/CISL sister labs
% for their valuable feedback on early iterations of my work, and for providing
% a stimulating environment to learn, grow, and foster my passion for operating system security.

% I am indebted to the many valuable members of the BPF and Linux kernel development
% community, whose hard work and dedication to free and open source software is reflected in
% the very foundations of this research. In particular, I would like to acknowledge Alexei
% Starovoitov and Daniel Borkmann for creating eBPF, Andrii Nakryiko for his work on
% \textit{libbpf} and CO-RE, and K.P.\ Singh for his work on bringing LSM hook support to
% BPF\@. Many other members of the BPF community have proved invaluable sources of
% inspiration and guidance throughout my academic career. While they are too many to name
% here, I appreciate them all the same.

% Lastly, I would like to thank my friends and family for their continued and unwavering
% support throughout this endeavour (and for many more endeavours to come).
% \endgroup
% \cleardoublepage%

\chapter*{Prior Publication}%
\addcontentsline{toc}{chapter}{Prior Publication}%
\begingroup
\small
A publication and pre-print have arisen as a direct result of the research in this thesis.
While these works represent joint contributions of all authors, any sections reproduced in
this thesis represent the sole work of the thesis author, with editorial and positioning
contributions by co-authors. Each work is listed below.

\Cref{c:bpfbox} contains text and ideas from our paper \enquote{\bpfbox{}: Simple Precise
Process Confinement in \gls{ebpf}}~\cite{findlay2020_bpfbox}, co-authored with Anil
Somayaji and David Barrera, and published at the Cloud Computer Security Workshop (CCSW)
2020 as part of the ACM CCS conference.

\Cref{c:bpfcontain} contains some text and ideas from our paper \enquote{\bpfcontain{}:
Fixing the Soft Underbelly of Container Security}~\cite{findlay2021_bpfcontain},
co-authored with David Barrera and Anil Somayaji. An early draft of this work is available
on the ArXiV pre-print database, although it differs substantially from the version
presented in this thesis.
\endgroup
\cleardoublepage%

% TOC
\begingroup
\hypersetup{linkcolor=black}
\tableofcontents
\begin{singlespace}
\listoffigures
\listoftables
\lstlistoflistings
\end{singlespace}
\endgroup

\mainmatter%

% ==============================================================================
% Main Chapter Content Here
% ==============================================================================

\chapter{Introduction}%
\label{c:introduction}
\input{chapters/introduction}

\chapter{Background and Related Work}%
\label{c:background}
\input{chapters/background}

\chapter{The Confinement Problem}%
\label{c:confinement-problem}
\input{chapters/confinement-problem}

\chapter{\bpfbox: A Prototype Process Confinement Mechanism}%
\label{c:bpfbox}
\input{chapters/bpfbox}

\chapter{\bpfcontain: Extending \bpfbox{} to Model Containers}%
\label{c:bpfcontain}
\input{chapters/bpfcontain}

\chapter{Evaluation}%
\label{c:evaluation}
\input{chapters/evaluation}

\chapter{Case Studies}%
\label{c:case-studies}
\input{chapters/case-studies}

\chapter{Discussion and Concluding Remarks}%
\label{c:discussion}
\input{chapters/discussion}

% \chapter{Conclusion}%
% \label{c:conclusion}
% \input{chapters/conclusion}

\cleardoublepage%
\printbibliography[heading=bibintoc]%
%\nocite{*} % TODO: Remove this when finished

\appendix%
\printglossary[type=\acronymtype, title=List of Acronyms, toctitle=List of Acronyms]

\end{document}
